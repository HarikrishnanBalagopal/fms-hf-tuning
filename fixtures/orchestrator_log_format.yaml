operations:
  - name: logger_on_log
    class: LogControl
    arguments:
      log_format: 'Epoch: {tc_metrics[state][epoch]:.0f}, Step: {tc_metrics[state][global_step]}, Rank: {tc_metrics[per_process_state][rank]}, loss = {tc_metrics[loss]}'
      log_level: INFO
  - name: logger_on_save
    class: LogControl
    arguments:
      log_format: |
        Saving model in huggingface format at samples_seen: {tc_metrics[state][global_step]}
        Model saved in {args.output_dir}/checkpoint-{tc_metrics[state][global_step]}
      log_level: INFO
controllers:
  - name: instructlab-on-log-format
    triggers:
      - on_log
    rule: 'loss != None'
    operations:
      - logger_on_log.should_log
  - name: instructlab-on-save-format
    triggers:
      - on_save
    rule: 'True'
    operations:
      - logger_on_save.should_log
